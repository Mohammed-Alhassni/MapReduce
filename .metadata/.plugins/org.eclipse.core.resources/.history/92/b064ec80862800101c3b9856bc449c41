import javax.swing.*;
import java.awt.*;
import java.io.IOException;
import java.util.concurrent.TimeUnit;
import com.opencsv.exceptions.CsvValidationException;

public class BuildDatasetUI extends JFrame {
    private JTextArea textArea;

    // File paths
    String samplePath = "/Users/mohmmedmsoud/Desktop/sem2 temp/pds project/SAMPLE2.txt";
    String csvPath = "/Users/mohmmedmsoud/Desktop/sem2 temp/pds project/Dataset2.csv";
    String jsonPath = "/Users/mohmmedmsoud/Desktop/sem2 temp/pds project/Dataset2.json";
    String XlsxPath = "/Users/mohmmedmsoud/Desktop/sem2 temp/pds project/Dataset2.xlsx";

    public BuildDatasetUI() {
        setTitle("Dataset Builder");
        setSize(500, 300);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        // Initialize JTextArea
        textArea = new JTextArea();
        textArea.setEditable(false);
        textArea.setFont(new Font("Monospaced", Font.PLAIN, 12));

        // Wrap the JTextArea inside a JScrollPane
        JScrollPane scrollPane = new JScrollPane(textArea);
        getContentPane().add(scrollPane, BorderLayout.CENTER);

        // Start the background process
        startProcessing();
    }

    // Method to display messages in the text area
    private void updateTextArea(String message) {
        textArea.append(message + "\n");
        textArea.setCaretPosition(textArea.getDocument().getLength());  // Auto-scroll to the end
    }

    private void startProcessing() {
        // Start the process in a separate thread to prevent UI freeze
        new Thread(() -> {
            try {
                BuildDataset mainClass = new BuildDataset();
                updateTextArea("Processing started...");
                
                long startNs = System.nanoTime();

                // Extract blocks and convert CSV to JSON
                BlocksExtractor.extractBlocks(mainClass.samplePath);
                JsonBuilder.convertCSVToJSON();
                
                long durationMs = TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startNs);
                updateTextArea("Done, took " + durationMs + "ms");

            } catch (IOException | CsvValidationException e) {
                updateTextArea("Error: " + e.getMessage());
            }
        }).start();
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            BuildDatasetUI frame = new BuildDatasetUI();
            frame.setVisible(true);
        });
    }
}
