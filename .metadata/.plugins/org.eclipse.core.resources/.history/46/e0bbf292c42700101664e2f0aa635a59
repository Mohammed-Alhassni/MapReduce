import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

public class Reducer {
	public static void ReducerFun(Map<String, Object> classAndFeatures) throws FileNotFoundException, IOException  {
		String samplePath = "output.csv";
		String className = null;
		File file = new File(samplePath);
		
		//set to extract the class name of the Map (classAndFeature Map)
		Set<String> classNameSet = new HashSet<>();
		classNameSet= classAndFeatures.keySet();
		
		for (String setELement: classNameSet) {
			//here we only have one key and object holding the feature, we want that key 
			//iterate through the map keys, although there only one key
			className= setELement;
			
		}
		
		
		if (!file.exists()) {
			try (FileWriter writer = new FileWriter(samplePath)) {
				System.out.println("New 'Output.csv' have been created");

				Map<String, String> featuresMap= new HashMap<>();
				Object interMediate= classAndFeatures.get(className);
				featuresMap= (Map<String, String>) interMediate;
				ArrayList<String> featureMapKeys= new  ArrayList<>();
				
				// Write header
				writer.append("class");
				for (String key : featuresMap.keySet()) {
					writer.append(","+ key);
				}
				
				writer.append("\n");
				
				
				// Write first row
				for (String key : featuresMap.keySet()) {
					featureMapKeys.add(key);
				}
				
				writer.append(className);
				for (String key : featureMapKeys) {
					writer.append(","+ featuresMap.get(key));
				}
				writer.append("\n");
				
				System.out.println("Head and Row added");
			}
    		
		} else if (file.exists()) {
				try (FileWriter writer = new FileWriter(samplePath, true)) {
				
				
				Map<String, String> featuresMap= new HashMap<>();
				
				Object interMediate= classAndFeatures.get(className);
				
				featuresMap= (Map<String, String>) interMediate;
				
				ArrayList<String> featureMapKeys= new  ArrayList<>();
				
				// Write other rows
				for (String key : featuresMap.keySet()) {
					featureMapKeys.add(key);
				}
				
				writer.append(className);
				for (String key : featureMapKeys) {
					writer.append(","+ featuresMap.get(key));
				}
				writer.append("\n");
				
				System.out.println("Row added");
				
			}
		}
           
	}
}
