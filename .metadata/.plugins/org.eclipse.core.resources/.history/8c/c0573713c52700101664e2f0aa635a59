import java.io.File;
import java.io.FileWriter;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

public class Reducer {
    public static void reduce(Map<String, Object> classAndFeatures) throws FileNotFoundException, IOException {
        String samplePath = "output.csv";
        String className = null;
        File file = new File(samplePath);

        Set<String> classNameSet = classAndFeatures.keySet();
        for (String setElement : classNameSet) {
            className = setElement;
        }

        Map<String, String> featuresMap = (Map<String, String>) classAndFeatures.get(className);
        ArrayList<String> featureMapKeys = new ArrayList<>(featuresMap.keySet());

        if (!file.exists()) {
            try (FileWriter writer = new FileWriter(file)) {
                System.out.println("New 'output.csv' has been created");

                // Write header
                writer.append("class");
                for (String key : featureMapKeys) {
                    writer.append(",").append(key);
                }
                writer.append("\n");

                // Write first row
                writer.append(className);
                for (String key : featureMapKeys) {
                    writer.append(",").append(featuresMap.get(key));
                }
                writer.append("\n");

                System.out.println("Header and first row added");
            }
        } else {
            try (FileWriter writer = new FileWriter(file, true)) {
                writer.append(className);
                for (String key : featureMapKeys) {
                    writer.append(",").append(featuresMap.get(key));
                }
                writer.append("\n");

                System.out.println("Row added");
            }
        }
    }
}

